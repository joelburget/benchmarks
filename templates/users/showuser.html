{% extends "base.html" %}
{% load comments %}
{% load gravatar %}
{% load tex %}

{% block title %}{{ object.get_profile.get_display_name }}{% endblock %}

{% block content %}
<div id="rss">
  <img src="{{ MEDIA_URL }}img/feed-icon16x16.png" height="16px" width="16px" />
  <span>Personal <a href="rss/">RSS</a> / <a href="atom/">Atom</a></span>
</div>
<div class="block">

<h2>{{ object.get_profile.get_display_name }}</h2>
  <div class="gravatar">
    <a href="{{ object.get_absolute_url }}">{% gravatar object.email 128 %}</a>
  </div>

  <table id="profile">
    <tr><td><b>Username</b></td><td>{{ object.username }}</td></tr>
    <tr><td><b>Real Name</b></td><td>{{ object.first_name }} {{ object.last_name }}</td></tr>
    <tr><td><b>Email</b></td><td>
    {% if user.is_authenticated %}
      {% if object.get_profile.showemail %}
        {{ object.email }}
      {% else %}
        {% if object.first_name %}{{ object.first_name }}{% else %}{{ object.username }}{% endif %} has opted out of showing this field.
      {% endif %}
    {% else %}
      <i>Please log in to see user email addresses.</i>
    {% endif %}</td></tr>

    <tr><td><b>Bio:</b></td><td>{% if object.get_profile.bio == '' %}This user hasn't entered a bio yet.{% else %}{{ object.get_profile.bio }}{% endif %}</td></tr>
    <tr><td><b>Joined</b></td><td>{{ object.date_joined }}</td></tr>
    <tr><td><b>Last Seen</b></td><td>{{ object.last_login }}</td></tr>
  </table>

  {% if user.username == object.username %}
  <p><a href="{{ object.get_absolute_url }}edit/">Edit Profile</a></p>
  {% endif %}
</div>

<div class="block">
<h2>Member of</h2>
{% if object.groups.all %}
{% for g in object.groups.all %}
  <p><b><a href="/groups/{{ g.pk }}">{{ g.name }}</a></b></p>
{% endfor %}
{% else %}
<p>This user hasn't joined any groups yet.</p>
{% endif %}
</div>

<div class="block">
<h2>Latest Posts &mdash; <a href="/posts/?title=&body=&user={{ object.username }}&problem=on&realization=on&verification=on&other=on&searchtxt=">(View all)</a></h2>
{% if posts %}
<ul>
{% for post in posts %}
	<div class="block">
	<h2><a href="{{ post.get_absolute_url }}">{{ post.title|truncatewords:"6" }}</a></h2>
	<p>{{ post.body|truncatewords_html:"50"|striptags }}</p>
	{% get_comment_count for post as comment_count %}
  <p class="postInfo"><span class="postType"><a href="{{ post.get_absolute_category_url }}">{{ post.get_category_display }}</a></span> Posted by: <a href="{{ post.author.get_absolute_url }}">{{ post.author.get_profile.get_display_name }}</a>, on {{ post.published }}</p>
	</div>
{% endfor %}
</ul>
{% else %}
<p>This user hasn't posted any content yet.</p>
{% endif %}
</div>

<div class="block">
<h2>Latest Discussion</h2>
{% if comments_list %}
<ul>
{% for comment in comments_list %}
  <div id="c{{ comment.id }}">
    <p class="commentBox">{{ comment.published|date:"F j, Y" }} at {{ comment.published|date:"P" }} - <a href="{{ comment.user.get_absolute_url }}">{{ comment.user.get_profile.get_display_name }}</a> on <a href="{{ comment.get_absolute_url }}">{{ comment.content_object.title }}</a></p> 
    <div class="gravatar"><a href="{{ comment.user.get_absolute_url }}">{% gravatar comment.user.email 48 %}</a></div>
    <div class="comment">{{ comment.comment|linebreaks|tex_to_images }}</div>
  </div></li>
{% endfor %}
</ul>
{% else %}
<p>This user hasn't commented on any posts yet.</p>
{% endif %}
</div>
{% endblock %}
