{% extends "base.html" %}
{% load tex %}

{% block title %}New Post{% endblock %}

{% block cssblock %}
<link rel="stylesheet" href="{{ MEDIA_URL }}css/uniform.custom.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="{{ MEDIA_URL }}css/validationEngine.jquery.css" type="text/css" media="screen" charset="utf-8" />
{% endblock %}

{% block content %}
<noscript>
  <h3 id="nojs">This page works best with Javascript enabled&hellip;</h3>
</noscript>

<h2>{% if edit %}Edit{% else %}New{% endif %} Post</h2>
<form id="newPostForm" action="." method="post" enctype="multipart/form-data" style="float:left;">
  {% comment %}I don't know how or why Django inserts the csrfmiddlewaretoken here, but it does{% endcomment %}

  {% if not post_id == None %}
  <input type="hidden" style="display:none;" name="post_id" id="post_id" value="{{ post_id }}" />
  {% endif %}

  <ol>
    <li>{{ form.title.label_tag }}</li>
    <li>{{ form.title }}</li>

    <li>{{ form.body.label_tag }}</li>
    <div id="minihelp">
    	<p>We accept LaTeX like <span style="font-family:monospace; font-size: 1.2em;">$$x^2$$</span>, and HTML like <code>pre</code>, <i>i</i>, <b>b</b>, and <a href="/formatting" target="_blank">more.</a></p>
    </div>    
    <li>{{ form.body }}</li>

    <input type="hidden" style="display:none;" value="{% if category %}{{ category }}{% else %}P{% endif %}" name="category" id="category" />
    <input type="hidden" style="display:none;" value="{{ user.pk }}" name="author" id="author" />
    <input type="hidden" style="display:none;" value="{{ user.get_profile.group.pk }}" name="group" id="group" />

    <li><label>Files</label></li>
    <li> 
      <ul id="fileUploads">
        <li><input class="realupload" type="file" name="file1" id="file1" /></li>
      </ul>
    </li>
    <li><a href="#" id="addFile">Add another file...</a></li>

    <li><input class="button" type="submit" value="Submit" /></li>
</ol>
</form>
{% endblock %}

{% block jsblock %}
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script src="{{ MEDIA_URL }}js/jquery.uniform.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}codemirror/js/codemirror.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}codemirror/js/mirrorframe.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}js/jquery.validationEngine-en.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}js/jquery.validationEngine.js" type="text/javascript"></script>

<script>
$(document).ready(function(){
  var num_files = 1;
  $('#newPostForm').validationEngine();
  $('#addFile').click(function() {
    num_files++;
    $('#fileUploads').append(
      '<li><input class="realupload" type="file" name="file' + num_files + '" id="file' + num_files + '" /></li>'
    );
    $('#file' + num_files).uniform();
    return false;
  });

  $("input:file").uniform();
  var editor = CodeMirror.fromTextArea('id_body', {
       parserfile: "parsexml.js",
       path: "{{ MEDIA_URL }}codemirror/js/",
       stylesheet: "{{ MEDIA_URL }}codemirror/css/xmlcolors.css",
       height: "400px",
       width: "500px",
       electricChars: false,
       //tabMode: "spaces",
       content: "{% filter escapejs %}{% firstof form.instance.body '<h2>Section Title</h2>' %}{% endfilter %}"
  });
  $("div.CodeMirror-wrapping textarea").attr("tabindex", "1");
});
</script>
{% endblock %}
