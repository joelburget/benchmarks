{% extends "base.html" %}
{% load partials %}

{% block title %}New Post{% endblock %}

{% block cssblock %}
<link rel="stylesheet" href="{{ MEDIA_URL }}css/uniform.custom.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="{{ MEDIA_URL }}css/validationEngine.jquery.css" type="text/css" media="screen" charset="utf-8" />
{% endblock %}

{% block content %}
<noscript>
  <h3 id="nojs">This page works best with Javascript enabled&hellip;</h3>
</noscript>

{% comment %}
{% load introspection %}
{% inspect_object "form" form %}
{% endcomment %}

<h2>{% if edit %}Edit{% else %}New{% endif %} Post</h2>

{% if user.get_profile.group == None %}
<p>Uh-oh! Please <a href="/groups">join a group</a> before posting content to the website!</p>
{% else %}
<form id="newPostForm" action="." method="post" enctype="multipart/form-data" style="float:left;">
  {% comment %}I don't know how or why Django inserts the csrfmiddlewaretoken here, but it does{% endcomment %}

  {% if not post_id == None %}
  <input type="hidden" style="display:none;" name="post_id" id="post_id" value="{{ post_id }}" />
  {% endif %}

  <ol>
    <li>{{ form.title.label_tag }}</li>
    <li>{{ form.title }}</li>

    <li>{{ form.body.label_tag }}</li>
    <li>{{ form.body|safe }}</li>

    <input type="hidden" style="display:none;" value="{% if category %}{{ category }}{% else %}P{% endif %}" name="category" id="category" />
    <input type="hidden" style="display:none;" value="{{ problem }}" name="problem" id="problem" />
    <input type="hidden" style="display:none;" value="{{ user.pk }}" name="author" id="author" />
    <input type="hidden" style="display:none;" value="{{ user.get_profile.group.pk }}" name="group" id="group" />

    {% if edit and is_problem %}
      <li><label for="substantial">Substantial edit? (note: this will flag current solutions as out of date, use only for very important edits to the problem's definition)</label>
      <input name="substantial" id="substantial" type="checkbox" /></li>
    {% endif %}

    <li><label>Files</label></li>
    <li> 
      <ul id="fileUploads">
        <li><input class="realupload" type="file" name="file1" id="file1" /></li>
      </ul>
    </li>
    <li><a href="#" id="addFile">Add another file...</a></li>

    <li><input class="button" type="submit" value="Submit" /></li>
</ol>
</form>
{% endif %}
{% endblock %}

{% block jsblock %}
{% include "partials/jquery.html" %}
<script src="{{ MEDIA_URL }}js/jquery.uniform.js" type="text/javascript"></script>
{% include "partials/jquery_texteditor.html" %}
{% include "partials/jquery_validation.html" %}

<script>
$(document).ready(function(){
  var num_files = 1;
  $('#newPostForm').validationEngine();
  $('#addFile').click(function() {
    num_files++;
    $('#fileUploads').append(
      '<li><input class="realupload" type="file" name="file' + num_files + '" id="file' + num_files + '" /></li>'
    );
    $('#file' + num_files).uniform();
    return false;
  });

  $("input:file").uniform();
  {% include "partials/textEditor.html" %}
});
</script>
{% endblock %}
