{% extends "base.html" %}
{% load tex %}

{% block title %}New Post{% endblock %}

{% block cssblock %}
<link rel="stylesheet" href="{{ MEDIA_URL }}css/uniform.default.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="{{ MEDIA_URL }}css/validationEngine.jquery.css" type="text/css" media="screen" charset="utf-8" />
{% endblock %}

{% block content %}
<h2>Edit Post</h2>
<form id="newPostForm" action="." method="post" enctype="multipart/form-data" style="float:left;">
  {% csrf_token %}
  <ol>
    <li>{{ form.title.label_tag }}</li>
    <li>{{ form.title }}</li>

    <li>{{ form.body.label_tag }}</li>
    <li>{{ form.body }}</li>

    <li>{{ form.category.label_tag }}</li>
    <li>{{ form.category }}</li>

    <li>
      <div id="parent_stuff">{{ form.parent.label_tag }}<span id="optional"> (Optional)</span> {{ form.parent }}</div>
    </li>

    <li><label>Files</label></li>
    <li id="fileUploads">
      <input class="realupload" type="file" name="file1" id="file1" />
    </li>
    <li><a href="#" id="addFile">Add another file...</a></li>

    <li><input class="button" type="submit" value="Submit" /></li>
</ol>
</form>

<div id="help"> 
  <h2>Help</h2>
  <h3>Basic HTML Formatting</h3>
  <p>We accept common HTML tags, such as <b>&lt;b&gt;</b>, <i>&lt;i&gt;</i>, and <code>&lt;code&gt;</code></p>

  <h3>Mathematical Expressions with LaTeX</h3>
  <p>Mathematical expressions can be made by enclosing LaTeX symbols inside of two pairs of dollar signs ($$1 + 1 = 2$$). We will automatically convert it to a professional looking image. See <a href="http://omega.albany.edu:8008/Symbols.html">here</a>, or the table below, for basic LaTeX syntax and example output.</p>

  <table id="latexDoc">
    <tr><td>$$3n^{n + 1}$$</td> <td class="tex">{{ "$$3n^{n + 1}$$"|tex_to_images }}</td></tr>
    <tr><td>$$\frac{22}{7} \approx \pi$$</td> <td class="tex">{{ "$$\frac{22}{7} \approx \pi$$"|tex_to_images }}</td></tr>
    <tr><td>$$\sum_{i=0}^n {i^2}$$</td> <td class="tex">{{ "$$\sum_{i=0}^n {i^2}$$"|tex_to_images }}</td></tr>
    <tr><td>$$P \to Q$$<br />$$P$$<br />$$\therefore Q$$</td> <td class="tex">{{ "$$P \to Q$$"|tex_to_images }} {{ "$$P$$"|tex_to_images }} {{ "$$\therefore Q$$"|tex_to_images }}</td></tr>
    <tr><td>$$\sqrt{x_i}$$</td> <td class="tex">{{ "$$\sqrt{x_i}$$"|tex_to_images }}</td></tr>
    <tr><td>$$3 \in {1, 2, 3}$$</td> <td class="tex">{{ "$$3 \in {1, 2, 3}$$"|tex_to_images }}</td></tr>
    <tr><td>$$\lim _{n \to \infty} x_n$$</td> <td class="tex">{{ "$$\lim _{n \to \infty} x_n$$"|tex_to_images }}</td></tr>
  </table>
</div>
{% endblock %}

{% block jsblock %}
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/TextboxList.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/TextboxList.Autocomplete.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/GrowingInput.js"></script>
<script src="{{ MEDIA_URL }}js/jquery.uniform.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}codemirror/js/codemirror.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}codemirror/js/mirrorframe.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}js/jquery.validationEngine-en.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}js/jquery.validationEngine.js" type="text/javascript"></script>

<script>
var num_files = 1;
(function($){
  $('#newPostForm').validationEngine();
  $('#addFile').click(function() {
    num_files++;
    $('#fileUploads').append(
      '<li><input class="realupload" type="file" name="file' + num_files + '" id="file' + num_files + '" /></li>'
    );
    $('#file' + num_files).uniform();
    return false;
  });
  $("#parent_stuff").hide();
  $("#optional").hide();
  $("#id_category").change(function(){
    var val = $(this).val();
    if (val === "O") {
      $("#optional").fadeIn();
    }
    else {
      $("#optional").fadeOut();
    }
    if ((val !== "") && (val !== "P")){
      $("#parent_stuff").slideDown();
    }
    else {
      $("#parent_stuff").slideUp();
    }
  });
  $("input:checkbox, input:radio, input:file").uniform();
  var editor = new CodeMirror.fromTextArea('id_body', {
       parserfile: "parsexml.js",
       path: "{{ MEDIA_URL }}codemirror/js/",
       stylesheet: "{{ MEDIA_URL }}codemirror/css/xmlcolors.css",
       height: "400px",
       width: "500px"
  });
  var t = new $.TextboxList('#id_parent', {max: 1, plugins: {autocomplete: {}}});
  var autocomplete = t.plugins.autocomplete;
  autocomplete.setValues([
  {% for object in object_list %}
  [{{ object.id }}, '{{ object.author.first_name }} {{ object.author.last_name }} - {{ object.title }}', '{{ object.title }}'],
  {% endfor %}
  ]);
  $('.textboxlist-autocomplete').css({'width': '541px', 'margin-left': '50px'});

  (function(){
    var source = $("#id_category");
    var selected = source.find("option[selected]");
    var options = $("option", source);
    
    /*$("body")*/source.after('<dl id="target" class="dropdown"></dl>');
    $("#target").append('<dt><a href="#">' + selected.text() + 
        '<span class="value">' + selected.val() + 
        '</span></a></dt>');
    $("#target").append('<dd><ul></ul></dd>');

    options.each(function(){
        $("#target dd ul").append('<li><a href="#">' + 
            $(this).text() + '<span class="value">' + 
            $(this).val() + '</span></a></li>');
    });
    source.hide();
  })();

  $(".dropdown dt a").click(function() {
      $(".dropdown dd ul").slideToggle();
  });

  $(document).bind('click', function(e) {
      var $clicked = $(e.target);
      if (! $clicked.parents().hasClass("dropdown"))
          $(".dropdown dd ul").hide();
  });
              
  $(".dropdown dd ul li a").click(function() {
      var text = $(this).html();
      $(".dropdown dt a").html(text);
      $(".dropdown dd ul").hide();
      
      var source = $("#id_category");
      source.val($(this).find("span.value").html());
  });  
})(jQuery);
</script>
{% endblock %}
